var errors=require("./errors"),request=require("request");require("sugar");var url=require("url"),util=require("util");module.exports=function(e,r,n,t,o,u){var i=function(o){return e+"://"+r+"/"+n+"/"+t+"/"+o.endpoint},s=function(e){return e-e%200===200},a=function(e){return e=Object.clone(e),e.url=i(e),delete e.endpoint,e.json=e.json||!0,e.timeout=u,e.json&&["object","boolean"].none(typeof e.json)&&(e.body=e.json,e.json=void 0),e.page&&(e.qs||(e.qs={}),e.qs.page=e.page,delete e.page),e.strictSSL=!1,new Promise(function(r,n){request(e,function(e,t,o){return e?n(e):r(s(t.statusCode)?o:errors.get(t))})})};return function(e){return o&&(e.headers={Authorization:"bearer "+o}),a(e)}};