var Docker=require("dockerode"),fs=require("fs"),util=require("util"),dockerif=module.exports.Docker=function(o){if(!o)throw"Miss docker config";this.docker=new Docker(o)},reDefContainer=module.exports.Container=function(o){if("string"==typeof o)throw"invalid container object";"object"==typeof o?(this.container=o,this.id=o.id):(this.container=null,console.log("this's no container obtained"))};reDefContainer.prototype.start=function(o,e){this.container.start(o,e)},reDefContainer.prototype.stop=function(o,e){this.container.stop(o,e)},reDefContainer.prototype.inspect=function(o){this.container.inspect(o)},reDefContainer.prototype.remove=function(o){this.container.remove(function(e,t){o&&o(e,t),console.log(t)})},reDefContainer.prototype.attach=function(o,e){this.container.attach(o,e)},reDefContainer.prototype.commit=function(o,e){this.container.commit(o,e)},reDefContainer.prototype.pause=function(o,e){this.container.pause(o,e)},reDefContainer.prototype.unpause=function(o,e){this.container.unpause(o,e)},reDefContainer.prototype.exec=function(o,e){this.container.exec(o,e)},reDefContainer.prototype.wait=function(o){this.container.wait(o)},reDefContainer.prototype.resize=function(o,e){this.container.resize(o,e)},dockerif.prototype.buildImage=function(o,e,t){this.docker.buildImage(o,e,t)},dockerif.prototype.getImage=function(o){return this.docker.getImage(o)},dockerif.prototype.isImageEixsting=function(o,e){this.getImage(o).inspect(function(o,t){e&&e(o,t)})},dockerif.prototype.listContainers=function(o,e){var t=this;this.docker.listContainers({all:o},function(o,n){if(o)throw console.log("Error occurs when list container"),o;console.log("Number of containers:"+n.length),n.forEach(function(o){var n=new reDefContainer(t.docker.getContainer(o.Id));e(n)})})},dockerif.prototype.createContainer=function(o,e){console.log("Creating container..."),this.docker.createContainer(o,function(o,t){if(o)throw console.log("Error occurs when creating the container: "+o),o;console.log("Id of created container: "+t.id);var n=new reDefContainer(t);console.log("type of refContainer.attach = "+typeof n.attach),e(n)})},dockerif.prototype.info=function(o){this.docker.info(o)},dockerif.prototype.pull=function(o,e,t){this.docker.pull(o,e,t)},dockerif.prototype.run=function(o,e,t,n){console.log("Creating container using 'docker run' ..."),this.docker.run(o,e,process.stdout,t,function(o,e,t){if(o)throw o;console.log("Return code:"+e.StatusCode),console.log("Id of created container: "+t.id);var i=new reDefContainer(t);n(i)})},dockerif.prototype.isContainerExisting=function(o,e){var t=this.docker.getContainer(o);t?t.inspect(function(o,t){o?e(!1,o):e(!0,t)}):e(!1,"not existing")},dockerif.prototype.getContainer=function(o,e){console.log("Getting container..."+o);var t=null,n=this.docker.getContainer(o);return n?(n.inspect(function(o,e){if(o)throw o;e&&console.log("Image name: "+e.Config.Image)}),t=new reDefContainer(n),e&&e(t)):(console.log("No container found with id "+o),e()),t},dockerif.prototype.removeContainer=function(o){console.log("Removing container..."+o);var e=new refDefContainer(o);e.remove(function(o,e){if(o)throw o;console.log("Output from container removal : "+e)})},dockerif.prototype.execContainer=function(o,e){console.log("Exec in container..."+o.id);var t={AttachStdout:!0,AttachStderr:!0,Tty:!1,Cmd:[e]};o.exec(t,function(o,e){if(o)throw o})};